# Kubernetes ç’°å¢ƒ
**é€é Kindã€K3D æˆ–å¤–éƒ¨ K8s é›†ç¾¤æä¾›å®Œæ•´çš„ Kubernetes é–‹ç™¼èˆ‡éƒ¨ç½²ç’°å¢ƒ**

KDE æ”¯æ´ä¸‰ç¨® Kubernetes ç’°å¢ƒé¡å‹ï¼Œæ¯ç¨®ç’°å¢ƒéƒ½æœ‰å…¶ç‰¹å®šçš„ä½¿ç”¨å ´æ™¯å’Œå„ªå‹¢ã€‚è«‹æ ¹æ“šæ‚¨çš„éœ€æ±‚é¸æ“‡åˆé©çš„ç’°å¢ƒé¡å‹ï¼š

## ç’°å¢ƒé¡å‹

### 1. [Kind ç’°å¢ƒ (Kubernetes in Docker)](./kubernetes/kind.md)
**æœ¬åœ°é–‹ç™¼ç’°å¢ƒï¼Œä½¿ç”¨ Docker å®¹å™¨æ¨¡æ“¬å®Œæ•´çš„ K8s ç¯€é»**

- **é©ç”¨å ´æ™¯**ï¼šæœ¬åœ°é–‹ç™¼ã€å®Œæ•´åŠŸèƒ½æ¸¬è©¦ã€è¤‡é›œæ‡‰ç”¨
- **å•Ÿå‹•é€Ÿåº¦**ï¼šå¿«é€Ÿï¼ˆ15-30 ç§’ï¼‰
- **è³‡æºä½”ç”¨**ï¼šä¸­ç­‰ï¼ˆ~500MBï¼‰
- **ç‰¹è‰²åŠŸèƒ½**ï¼š
    - æ›´æ¥è¿‘çœŸå¯¦ K8s ç’°å¢ƒ
    - æ”¯æ´å¤šç¯€é»é…ç½®ï¼ˆcontrol-plane + workerï¼‰
    - å®Œæ•´çš„ K8s çµ„ä»¶
    - Docker ç¶²è·¯æ•´åˆï¼Œé–‹ç™¼å®¹å™¨å¯ç›´æ¥å­˜å– K8s æœå‹™
    - PVC è‡ªå‹•æ›è¼‰å°ˆæ¡ˆè³‡æ–™å¤¾
    - æ”¯æ´ `kde load-image` è¼‰å…¥æœ¬åœ°æ˜ åƒ

ğŸ“– [æŸ¥çœ‹ Kind ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/kind.md)

### 2. [K3D ç’°å¢ƒ (K3s in Docker)](./kubernetes/k3d.md)
**è¼•é‡ç´šæœ¬åœ°é–‹ç™¼ç’°å¢ƒï¼ŒåŸºæ–¼ K3s çš„ Docker å®¹å™¨**

- **é©ç”¨å ´æ™¯**ï¼šå¿«é€Ÿé–‹ç™¼ã€CI/CDã€è³‡æºå—é™ç’°å¢ƒ
- **å•Ÿå‹•é€Ÿåº¦**ï¼šæ¥µå¿«ï¼ˆ5-10 ç§’ï¼‰
- **è³‡æºä½”ç”¨**ï¼šæ¥µä½ï¼ˆ~200MBï¼‰
- **ç‰¹è‰²åŠŸèƒ½**ï¼š
    - å•Ÿå‹•å’Œæ¸…ç†æ¥µå¿«é€Ÿ
    - é©åˆå¿«é€Ÿè¿­ä»£é–‹ç™¼
    - é©åˆ CI/CD æ•´åˆæ¸¬è©¦
    - Docker ç¶²è·¯æ•´åˆ
    - PVC è‡ªå‹•æ›è¼‰å°ˆæ¡ˆè³‡æ–™å¤¾
    - æ”¯æ´ `kde load-image` è¼‰å…¥æœ¬åœ°æ˜ åƒ

ğŸ“– [æŸ¥çœ‹ K3D ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/k3d.md)

### 3. [å¤–éƒ¨ Kubernetes ç’°å¢ƒ](./kubernetes/external-kubernetes.md)
**é€£æ¥åˆ°ç¾æœ‰çš„ Kubernetes é›†ç¾¤ï¼ˆé›²ç«¯æˆ–é ç«¯é›†ç¾¤ï¼‰**

- **é©ç”¨å ´æ™¯**ï¼šç”Ÿç”¢ç’°å¢ƒã€åœ˜éšŠå”ä½œã€é›²ç«¯éƒ¨ç½²
- **å•Ÿå‹•é€Ÿåº¦**ï¼šN/Aï¼ˆé›†ç¾¤å·²å­˜åœ¨ï¼‰
- **è³‡æºä½”ç”¨**ï¼šå–æ±ºæ–¼é›²ç«¯é›†ç¾¤
- **ç‰¹è‰²åŠŸèƒ½**ï¼š
    - é€£æ¥åˆ° AWS EKSã€Google GKEã€Azure AKS ç­‰
    - é€£æ¥åˆ°è‡ªå»º on-premises K8s é›†ç¾¤
    - æ”¯æ´å¤šé›²ç«¯ç’°å¢ƒç®¡ç†
    - å®Œæ•´çš„ç”Ÿç”¢ç´šåŠŸèƒ½
    - é€é kubectl API é€£æ¥

ğŸ“– [æŸ¥çœ‹å¤–éƒ¨ Kubernetes ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/external-kubernetes.md)

## ç’°å¢ƒé¡å‹å¿«é€Ÿæ¯”è¼ƒ

| ç‰¹æ€§ | Kind | K3D | å¤–éƒ¨ K8s |
|------|------|-----|----------|
| å•Ÿå‹•é€Ÿåº¦ | å¿«é€Ÿï¼ˆ15-30sï¼‰ | æ¥µå¿«ï¼ˆ5-10sï¼‰ | N/Aï¼ˆå·²å­˜åœ¨ï¼‰ |
| è³‡æºä½”ç”¨ | ä¸­ç­‰ï¼ˆ~500MBï¼‰ | æ¥µä½ï¼ˆ~200MBï¼‰ | å–æ±ºæ–¼é›†ç¾¤ |
| K8s å®Œæ•´æ€§ | å®Œæ•´ | ç²¾ç°¡ | å®Œæ•´ |
| é©ç”¨å ´æ™¯ | æœ¬åœ°é–‹ç™¼ã€æ¸¬è©¦ | å¿«é€Ÿé–‹ç™¼ã€CI/CD | ç”Ÿç”¢ã€åœ˜éšŠå”ä½œ |
| ç¶²è·¯æ•´åˆ | Docker ç¶²è·¯ | Docker ç¶²è·¯ | kubectl API |
| æ˜ åƒè¼‰å…¥ | æ”¯æ´ | æ”¯æ´ | ä¸æ”¯æ´ï¼ˆéœ€ Registryï¼‰ |
| PVC æ›è¼‰ | è‡ªå‹•æ›è¼‰å°ˆæ¡ˆè³‡æ–™å¤¾ | è‡ªå‹•æ›è¼‰å°ˆæ¡ˆè³‡æ–™å¤¾ | æ¨™æº– PVC |
| é…ç½®éˆæ´»æ€§ | é«˜ | é«˜ | å–æ±ºæ–¼é›†ç¾¤ |
| æˆæœ¬ | å…è²» | å…è²» | å¯èƒ½éœ€è¦é›²ç«¯è²»ç”¨ |

## å¿«é€Ÿé–‹å§‹

### å»ºç«‹ Kind ç’°å¢ƒ
```bash
kde start dev-env kind
```

### å»ºç«‹ K3D ç’°å¢ƒ
```bash
kde start test-env k3d
```

### é€£æ¥å¤–éƒ¨ K8s ç’°å¢ƒ
```bash
kde start prod-env k8s ~/.kube/config
```

## é€šç”¨ç’°å¢ƒç®¡ç†æŒ‡ä»¤

ä»¥ä¸‹æŒ‡ä»¤é©ç”¨æ–¼æ‰€æœ‰ç’°å¢ƒé¡å‹ï¼ˆéƒ¨åˆ†æŒ‡ä»¤åƒ…é©ç”¨æ–¼ Kind/K3Dï¼‰ï¼š

### ç’°å¢ƒç®¡ç†
```bash
# åˆ—å‡ºæ‰€æœ‰ç’°å¢ƒ
kde list

# æŸ¥çœ‹ç’°å¢ƒç‹€æ…‹
kde status

# åˆ‡æ›ç’°å¢ƒ
kde use <env_name>

# åœæ­¢ç’°å¢ƒï¼ˆåƒ… Kind/K3Dï¼‰
kde stop <env_name>

# é‡å•Ÿç’°å¢ƒï¼ˆåƒ… Kind/K3Dï¼‰
kde restart <env_name>

# åˆªé™¤ç’°å¢ƒ
kde remove <env_name>

# é‡ç½®ç’°å¢ƒï¼ˆåƒ… Kind/K3Dï¼‰
kde reset <env_name>
```

### Kubernetes æ“ä½œ
```bash
# é€²å…¥ç¯€é»å®¹å™¨ï¼ˆåƒ… Kind/K3Dï¼‰
kde exec <env_name>

# è¼‰å…¥æ˜ åƒï¼ˆåƒ… Kind/K3Dï¼‰
kde load-image <image> <env_name>

# Port Forwardï¼ˆæ‰€æœ‰ç’°å¢ƒï¼‰
kde expose [namespace] [pod|service] [resource_name] [target_port] [local_port]

# K9s ç›£æ§ï¼ˆæ‰€æœ‰ç’°å¢ƒï¼‰
kde k9s

# Dashboard ç®¡ç†ï¼ˆæ‰€æœ‰ç’°å¢ƒï¼‰
kde dashboard
```

## é¸æ“‡å»ºè­°

### ä½•æ™‚ä½¿ç”¨ Kindï¼Ÿ
- âœ… éœ€è¦å®Œæ•´çš„ K8s åŠŸèƒ½æ¸¬è©¦
- âœ… é–‹ç™¼è¤‡é›œçš„ K8s æ‡‰ç”¨
- âœ… éœ€è¦å¤šç¯€é»é…ç½®
- âœ… å­¸ç¿’å®Œæ•´çš„ Kubernetes
- âœ… æœ¬åœ°é–‹ç™¼ç’°å¢ƒ

### ä½•æ™‚ä½¿ç”¨ K3Dï¼Ÿ
- âœ… å¿«é€Ÿé–‹ç™¼èˆ‡è¿­ä»£
- âœ… CI/CD æ•´åˆæ¸¬è©¦
- âœ… è³‡æºå—é™çš„é–‹ç™¼ç’°å¢ƒ
- âœ… éœ€è¦é »ç¹å»ºç«‹/åˆªé™¤ç’°å¢ƒ
- âœ… å­¸ç¿’ Kubernetes åŸºç¤

### ä½•æ™‚ä½¿ç”¨å¤–éƒ¨ K8sï¼Ÿ
- âœ… ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²
- âœ… åœ˜éšŠå”ä½œé–‹ç™¼
- âœ… éœ€è¦é›²ç«¯ K8s å®Œæ•´åŠŸèƒ½
- âœ… é«˜å¯ç”¨å’Œæ“´å±•æ€§éœ€æ±‚
- âœ… å¤šå€åŸŸéƒ¨ç½²
- âœ… é€£æ¥ç¾æœ‰ä¼æ¥­ K8s

## è©³ç´°æ–‡æª”

- **[Kind ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/kind.md)** - å®Œæ•´çš„ Kind ç’°å¢ƒä½¿ç”¨æŒ‡å—
- **[K3D ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/k3d.md)** - å®Œæ•´çš„ K3D ç’°å¢ƒä½¿ç”¨æŒ‡å—
- **[å¤–éƒ¨ Kubernetes ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/external-kubernetes.md)** - å¤–éƒ¨ K8s ç’°å¢ƒé€£æ¥èˆ‡ä½¿ç”¨æŒ‡å—

## å…±é€šåŠŸèƒ½èªªæ˜
## å…±é€šç’°å¢ƒè®Šæ•¸
| ç’°å¢ƒè®Šæ•¸ | èªªæ˜ | é©ç”¨ç’°å¢ƒ | ç¯„ä¾‹ |
|---------|------|----------|------|
| `ENV_NAME` | ç’°å¢ƒåç¨± | å…¨éƒ¨ï¼ˆKind/K3D/å¤–éƒ¨ K8sï¼‰ | `ENV_NAME=dev-env` |
| `ENV_TYPE` | ç’°å¢ƒé¡å‹ï¼ˆkind/k3d/k8sï¼‰ | å…¨éƒ¨ | `ENV_TYPE=kind` |
| `K8S_CONTAINER_NAME` | Kind/K3Dï¼šç¯€é»å®¹å™¨åç¨±ï¼›å¤–éƒ¨ K8sï¼šAPI Server ä½å€ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼Œä¸€èˆ¬ä¸éœ€æ‰‹å‹•ä¿®æ”¹ï¼‰ | å…¨éƒ¨ | `K8S_CONTAINER_NAME=dev-env-control-plane` |
| `DOCKER_NETWORK` | Docker ç¶²è·¯åç¨± | Kind/K3D | `DOCKER_NETWORK=kde-dev-env` |
| `STORAGE_CLASS` | é è¨­å„²å­˜é¡åˆ¥ | Kind/K3D | `STORAGE_CLASS=local-path` |
| `K8S_API_SERVER_PORT` | K8s API Server ç«¯å£ | Kind/K3D | `K8S_API_SERVER_PORT=6443` |
| `K8S_INGRESS_NGINX_PORT` | Ingress Nginx ç«¯å£ | Kind/K3D | `K8S_INGRESS_NGINX_PORT=80` |
| `KUBECONFIG` | Kubeconfig æª”æ¡ˆè·¯å¾‘ | å…¨éƒ¨ | `KUBECONFIG=/opt/kde/environments/dev-env/kubeconfig/config` |
| `VOLUMES_PATH` | Volume è³‡æ–™å¤¾è·¯å¾‘ | Kind/K3D | `VOLUMES_PATH=/opt/kde/environments/dev-env/volumes` |

> ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œé€™äº›ç’°å¢ƒè®Šæ•¸æœƒç”± `kde start` è‡ªå‹•ç”¢ç”Ÿä¸¦ç¶­è­·ï¼Œ**ä¸éœ€è¦æ‰‹å‹•ä¿®æ”¹**ï¼›åªæœ‰åœ¨å®¢è£½åŒ–ç’°å¢ƒè…³æœ¬æˆ–é™¤éŒ¯æ™‚æ‰éœ€è¦ç‰¹åˆ¥é—œæ³¨ã€‚

## å…±é€š Best Practice

### ç’°å¢ƒé¡å‹é¸æ“‡
- **æœ¬åœ°é–‹ç™¼**: å„ªå…ˆä½¿ç”¨ Kind æˆ– K3D
- **CI/CD**: å»ºè­°ä½¿ç”¨ K3Dï¼ˆå•Ÿå‹•é€Ÿåº¦å¿«ã€è³‡æºä½”ç”¨å°‘ï¼‰
- **ç”Ÿç”¢é©—è­‰**: ä½¿ç”¨å¤–éƒ¨ K8s ç’°å¢ƒé€£æ¥åˆ°å¯¦éš›é›†ç¾¤
- **åœ˜éšŠå”ä½œ**: ç‚ºä¸åŒæˆå“¡å»ºç«‹ç¨ç«‹çš„ç’°å¢ƒï¼Œé¿å…è¡çª

### ç’°å¢ƒå‘½åè¦ç¯„
- ä½¿ç”¨æœ‰æ„ç¾©çš„åç¨±ï¼š`dev-env`, `test-env`, `staging-env`
- é¿å…ç‰¹æ®Šå­—å…ƒï¼Œä½¿ç”¨å°å¯«å­—æ¯å’Œé€£å­—è™Ÿ
- åœ˜éšŠæˆå“¡å¯ä»¥åŠ ä¸Šå€‹äººå‰ç¶´ï¼š`john-dev-env`, `mary-test-env`

### å¤šç’°å¢ƒç®¡ç†
- ç‚ºä¸åŒç”¨é€”å»ºç«‹ç¨ç«‹ç’°å¢ƒï¼ˆé–‹ç™¼ã€æ¸¬è©¦ã€é©—è­‰ã€ç”Ÿç”¢ï¼‰
- ä½¿ç”¨ `kde use` å¿«é€Ÿåˆ‡æ›ç’°å¢ƒ
- é¿å…åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­é€²è¡Œå¯¦é©—æ€§æ“ä½œ
- ä¿æŒç’°å¢ƒé…ç½®çš„æ–‡æª”åŒ–

### ç’°å¢ƒç¶­è­·
- å®šæœŸæ¸…ç†ä¸ä½¿ç”¨çš„ç’°å¢ƒï¼ˆ`kde remove`ï¼‰
- ç›£æ§ Docker å®¹å™¨å’Œæ˜ åƒä½”ç”¨çš„ç£ç¢Ÿç©ºé–“
- å®šæœŸæ›´æ–° Kindã€K3D æ˜ åƒç‰ˆæœ¬
- è¨˜éŒ„ç’°å¢ƒé…ç½®å’Œè®Šæ›´

### èˆ‡å…¶ä»– KDE åŠŸèƒ½æ•´åˆ
- ä½¿ç”¨ K9s ç›£æ§ç’°å¢ƒç‹€æ…‹ï¼ˆ`kde k9s`ï¼‰
- ä½¿ç”¨ Dashboard é€²è¡Œåœ–å½¢åŒ–ç®¡ç†ï¼ˆ`kde dashboard`ï¼‰
- é…åˆå°ˆæ¡ˆç®¡ç†é€²è¡Œæ‡‰ç”¨éƒ¨ç½²ï¼ˆ`kde proj deploy`ï¼‰
- ä½¿ç”¨ Telepresence é€²è¡Œæœ¬åœ°é–‹ç™¼èˆ‡ K8s æ•´åˆï¼ˆ`kde telepresence`ï¼‰
- ä½¿ç”¨ Ngrok/Cloudflare Tunnel æä¾›å¤–éƒ¨å­˜å–

### é–‹ç™¼å·¥ä½œæµç¨‹å»ºè­°
1. å»ºç«‹é–‹ç™¼ç’°å¢ƒï¼ˆKind æˆ– K3Dï¼‰
2. å»ºç«‹å°ˆæ¡ˆ
3. è¼‰å…¥æ˜ åƒï¼ˆKind/K3Dï¼‰æˆ–æ¨é€åˆ° Registryï¼ˆå¤–éƒ¨ K8sï¼‰
4. éƒ¨ç½²å°ˆæ¡ˆ
5. ä½¿ç”¨ K9s æˆ– Dashboard ç›£æ§
6. é€²è¡Œé–‹ç™¼èˆ‡æ¸¬è©¦
7. å®Œæˆå¾Œæ¸…ç†ç’°å¢ƒ

### é™¤éŒ¯æŠ€å·§

**KDE CLI å±¤ç´šé™¤éŒ¯**ï¼š
- å•Ÿç”¨é™¤éŒ¯æ¨¡å¼ï¼š`KDE_DEBUG=true kde start dev-env kind`
- è¿½è¹¤ KDE å…§éƒ¨åŸ·è¡Œæµç¨‹ï¼ŒæŸ¥çœ‹æ¯å€‹åŸ·è¡Œçš„å‘½ä»¤

**Kubernetes å±¤ç´šé™¤éŒ¯**ï¼š
- ä½¿ç”¨ `kubectl get events -A` æŸ¥çœ‹é›†ç¾¤äº‹ä»¶
- ä½¿ç”¨ `kubectl describe` æŸ¥çœ‹è³‡æºè©³ç´°è³‡è¨Š
- ä½¿ç”¨ `kubectl logs` æŸ¥çœ‹ Pod æ—¥èªŒ
- é€²å…¥ç¯€é»å®¹å™¨æª¢æŸ¥ï¼š`kde exec`ï¼ˆKind/K3Dï¼‰

**ç›£æ§å·¥å…·**ï¼š
- ä½¿ç”¨ K9s é€²è¡Œå³æ™‚ç›£æ§å’Œæ“ä½œï¼š`kde k9s`
- ä½¿ç”¨ Headlamp Web UIï¼š`kde headlamp`

**é…ç½®æª¢æŸ¥**ï¼š
- æª¢æŸ¥ç’°å¢ƒé…ç½®æª”æ¡ˆï¼š`cat environments/<env_name>/k8s.env`
- æª¢æŸ¥ kubeconfigï¼š`cat environments/<env_name>/kubeconfig/config`

---

**æ›´å¤šè©³ç´°è³‡è¨Šå’Œæœ€ä½³å¯¦è¸ï¼Œè«‹åƒè€ƒå„ç’°å¢ƒé¡å‹çš„è©³ç´°æ–‡æª”ï¼š**

- **[Kind ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/kind.md)**
- **[K3D ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/k3d.md)**
- **[å¤–éƒ¨ Kubernetes ç’°å¢ƒè©³ç´°æ–‡æª”](./kubernetes/external-kubernetes.md)**
